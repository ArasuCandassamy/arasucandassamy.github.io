{% comment %}
Determine current language from page.lang or URL path (same logic as other components)
{% endcomment %}
{% assign current_lang = page.lang | default: site.default_lang | default: "fr" %}
{% comment %}Fallback: detect language from URL if page.lang is not set{% endcomment %}
{% if page.url contains '/en/' %}
  {% assign current_lang = "en" %}
{% endif %}

{% assign other_lang = "en" %}
{% if current_lang == "en" %}
  {% assign other_lang = "fr" %}
{% endif %}
{% assign languages = site.data.languages %}

<div class="language-switcher">
  <button id="language-toggle" class="language-btn">
    <span class="flag">{{ languages.languages[other_lang].flag }}</span>
    <span class="lang-name">{{ languages.languages[other_lang].name }}</span>
  </button>
</div>

<style>
.language-switcher {
  position: fixed;
  top: 12px;
  right: 20px;
  z-index: 1000;
}

.language-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: var(--global-bg-color, #fff);
  border: 2px solid var(--global-border-color, #ddd);
  border-radius: 25px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  font-size: 14px;
  font-weight: 500;
  color: var(--global-text-color, #333);
}

.language-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  border-color: var(--global-link-color, #52adc8);
}

.flag {
  font-size: 16px;
}

.lang-name {
  min-width: 60px;
  text-align: left;
}

/* Dark mode styles */
html[data-theme="dark"] .language-btn {
  background: var(--global-bg-color, #333);
  border-color: rgba(255, 255, 255, 0.2);
  color: var(--global-text-color, #fff);
}

html[data-theme="dark"] .language-btn:hover {
  border-color: var(--global-link-color, #52adc8);
  background: rgba(255, 255, 255, 0.05);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  'use strict';
  
  var languageToggle = document.getElementById('language-toggle');
  if (!languageToggle) return;
  
  languageToggle.addEventListener('click', function() {
    try {
      var currentPath = window.location.pathname;
      var newPath = '';
      
      // Simple mapping logic
      if (currentPath.startsWith('/en/')) {
        // English to French
        if (currentPath === '/en/') {
          newPath = '/';
        } else if (currentPath === '/en/cv/') {
          newPath = '/cv/';
        } else if (currentPath === '/en/about/') {
          newPath = '/about/';
        } else if (currentPath === '/en/teaching/') {
          newPath = '/teaching/';
        } else {
          newPath = currentPath.replace(/^\/en\//, '/');
        }
      } else {
        // French to English
        if (currentPath === '/') {
          newPath = '/en/';
        } else if (currentPath === '/cv/') {
          newPath = '/en/cv/';
        } else if (currentPath === '/about/') {
          newPath = '/en/about/';
        } else if (currentPath === '/teaching/') {
          newPath = '/en/teaching/';
        } else {
          newPath = '/en' + currentPath;
        }
      }
      
      // Store preference
      var newLang = currentPath.startsWith('/en/') ? 'fr' : 'en';
      try {
        localStorage.setItem('preferred-language', newLang);
      } catch(e) {
        // Ignore localStorage errors
      }
      
      // Navigate
      window.location.href = newPath;
      
    } catch(error) {
      console.error('Language toggle error:', error);
    }
  });
});
</script>
